{% extends 'base.html' %}

{% block title %}Gestión de Usuarios{% endblock %}

{% block content %}
<div class="container">
    <div class="card card-medical">
        <div class="card-header-medical text-white d-flex justify-content-between align-items-center">
            <h3 class="card-title mb-0">
                <i class="bi bi-people me-2"></i>Gestión de Usuarios
            </h3>
            <a href="{% url 'core:crear_usuario' %}" class="btn btn-light">
                <i class="bi bi-plus-circle me-1"></i> Nuevo Usuario
            </a>
        </div>
        <div class="card-body">
            
            {% if usuarios %}
                <div class="table-responsive">
                    <table class="table table-medical">
                        <thead>
                            <tr>
                                <th>Usuario</th>
                                <th>Nombre</th>
                                <th>Email</th>
                                <th>Rol</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for usuario in usuarios %}
                                <tr>
                                    <td>{{ usuario.username }}</td>
                                    <td>{{ usuario.get_full_name|default:"-" }}</td>
                                    <td>{{ usuario.email|default:"-" }}</td>
                                    <td>
                                        {% if usuario.perfilusuario.rol == 'admin' %}
                                            <span class="badge bg-danger">{{ usuario.perfilusuario.get_rol_display }}</span>
                                        {% elif usuario.perfilusuario.rol == 'medico' %}
                                            <span class="badge bg-info">{{ usuario.perfilusuario.get_rol_display }}</span>
                                        {% else %}
                                            <span class="badge bg-warning text-dark">{{ usuario.perfilusuario.get_rol_display }}</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if usuario.is_active %}
                                            <span class="badge bg-success">Activo</span>
                                        {% else %}
                                            <span class="badge bg-secondary">Inactivo</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <div class="btn-group" role="group">
                                            <button type="button" class="btn btn-sm btn-outline-medical dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                                                Acciones
                                            </button>
                                            <ul class="dropdown-menu">
                                                <li>
                                                    <a class="dropdown-item" href="{% url 'core:editar_usuario' usuario.pk %}">
                                                        <i class="bi bi-pencil-square me-1"></i> Editar Usuario
                                                    </a>
                                                </li>
                                                <li>
                                                    <a class="dropdown-item" href="{% url 'core:cambiar_contrasena' usuario.pk %}">
                                                        <i class="bi bi-key me-1"></i> Cambiar Contraseña
                                                    </a>
                                                </li>
                                                <li><hr class="dropdown-divider"></li>
                                                <li>
                                                    <a class="dropdown-item text-danger" href="{% url 'core:eliminar_usuario' usuario.pk %}">
                                                        <i class="bi bi-trash me-1"></i> Eliminar
                                                    </a>
                                                </li>
                                                <li>
                                                    <a class="dropdown-item" href="{% url 'core:cambiar_rol' usuario.id %}">
                                                        <i class="bi bi-person-bounding-box me-1"></i> Cambiar Rol
                                                    </a>
                                                </li>
                                            </ul>
                                        </div>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="text-center py-5">
                    <i class="bi bi-people fs-1 text-muted mb-3"></i>
                    <p class="text-muted">No hay usuarios registrados aún.</p>
                    <a href="{% url 'core:crear_usuario' %}" class="btn btn-medical-primary">
                        <i class="bi bi-plus-circle me-1"></i> Crear Primer Usuario
                    </a>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}